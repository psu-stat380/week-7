<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<<<<<<< HEAD
<title>Weeks 6 &amp; 7</title>
=======
<title>Week 7</title>
>>>>>>> 5aee636 (fasttrack)
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
<<<<<<< HEAD
      <h1 class="title">Weeks 6 &amp; 7</h1>
=======
      <h1 class="title">Week 7</h1>
>>>>>>> 5aee636 (fasttrack)
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-1_bb83323f469f883993be30837b961404">

</div>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda:</h2>
<ol type="1">
<<<<<<< HEAD
<li>Multicollinearity</li>
<li>Variable selection</li>
<li>Shrinkage Estimators</li>
</ol>
<section id="packages-we-will-require-this-week" class="level4">
<h4 class="anchored" data-anchor-id="packages-we-will-require-this-week">Packages we will require this week</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-1_eca713e36a422cce468a8342a903c635">
=======
<li>Automatic differentiation</li>
<li>Cross validation</li>
<li>Classification</li>
</ol>
<section id="packages-we-will-require-this-week" class="level4">
<h4 class="anchored" data-anchor-id="packages-we-will-require-this-week">Packages we will require this week</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-2_3e158d6433cda5638a47f4a3dd7ec703">
>>>>>>> 5aee636 (fasttrack)
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Old packages</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ISLR2"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dplyr"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tidyr"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"readr"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"purrr"</span>,</span>
<<<<<<< HEAD
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># New packages</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"glmnet"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"caret"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"car"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"corrplot"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"repr"</span></span>
=======
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"glmnet"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"caret"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"repr"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NEW</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"torch"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mlbench"</span></span>
>>>>>>> 5aee636 (fasttrack)
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># renv::install(packages)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(packages, require, <span class="at">character.only=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<<<<<<< HEAD
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: repr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'repr'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   ISLR2    dplyr    tidyr    readr    purrr   glmnet    caret      car 
    TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE 
corrplot     repr 
    TRUE    FALSE </code></pre>
</div>
</div>
<p><br><br><br><br></p>
<hr>
</section>
</section>
<section id="tue-feb-14" class="level1">
<h1>Tue, Feb 14</h1>
<p>In this class, we are going to look at variable selection. Consider the <strong>Boston housing dataset</strong> which is described <a href="https://www.kaggle.com/datasets/schirmerchad/bostonhoustingmlnd">here</a>:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-2_fc123fcc1477094b30df160ff72983a3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Boston)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Boston)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     crim zn indus chas   nox    rm  age    dis rad tax ptratio lstat medv
1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3  4.98 24.0
2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8  9.14 21.6
3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8  4.03 34.7
4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7  2.94 33.4
5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7  5.33 36.2
6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7  5.21 28.7</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-3_bc640cd1d897ae7dac52bd9b1c25ed5c">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Boston <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">chas =</span> <span class="fu">as.factor</span>(chas))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     crim zn indus chas   nox    rm  age    dis rad tax ptratio lstat medv
1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3  4.98 24.0
2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8  9.14 21.6
3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8  4.03 34.7
4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7  2.94 33.4
5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7  5.33 36.2
6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7  5.21 28.7</code></pre>
</div>
</div>
<p><br><br><br><br></p>
<section id="explanation-of-the-variables" class="level3">
<h3 class="anchored" data-anchor-id="explanation-of-the-variables">Explanation of the variables</h3>
<p>The original data are 506 observations on 14 variables, medv being the target variable:</p>
<ul>
<li><code>crim</code> per capita crime rate by town</li>
<li><code>zn</code> proportion of residential land zoned for lots over 25,000 sq.ft</li>
<li><code>indus</code> proportion of non-retail business acres per town</li>
<li><code>chas</code> Charles River dummy variable (= 1 if tract bounds river; 0 otherwise)</li>
<li><code>nox</code> nitric oxides concentration (parts per 10 million)</li>
<li><code>rm</code> average number of rooms per dwelling</li>
<li><code>age</code> proportion of owner-occupied units built prior to 1940</li>
<li><code>dis</code> weighted distances to five Boston employment centres</li>
<li><code>rad</code> index of accessibility to radial highways</li>
<li><code>tax</code> full-value property-tax rate per USD 10,000</li>
<li><code>ptratio</code> pupil-teacher ratio by town</li>
<li>~<code>b</code> 1000(B - 0.63)^2 where B is the proportion of black residents by town~</li>
<li><code>lstat</code> percentage of lower status of the population</li>
<li><code>medv</code> median value of owner-occupied homes in USD 1000’s</li>
</ul>
<p><br><br><br><br></p>
</section>
<section id="eda" class="level3">
<h3 class="anchored" data-anchor-id="eda">EDA:</h3>
<section id="histograms" class="level4">
<h4 class="anchored" data-anchor-id="histograms">Histograms</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-4_6111dada364f1833f09a69058a77f739">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="boxplot-of-the-variables" class="level4">
<h4 class="anchored" data-anchor-id="boxplot-of-the-variables">Boxplot of the variables</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-5_f77d8c0cbab39c09519c278e523600f6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>value)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> key,<span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="scatterplot-of-the-variables" class="level4">
<h4 class="anchored" data-anchor-id="scatterplot-of-the-variables">Scatterplot of the variables</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-6_39f6e3653b124f9835d5ac7c815408a8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>chas) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gather</span>(key, val, <span class="sc">-</span>medv) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> medv)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="regression-model" class="level3">
<h3 class="anchored" data-anchor-id="regression-model">Regression model</h3>
<p>We begin by creating a regression model to predict <code>medv</code> using all the predictors:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-7_93f845dd59baa9167ad0e3fe3cf36261">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., df)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(full_model)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 5
   term         estimate std.error statistic  p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.6       4.94        8.43  3.79e-16
 2 crim         -0.121     0.0330     -3.68  2.61e- 4
 3 zn            0.0470    0.0139      3.38  7.72e- 4
 4 indus         0.0135    0.0621      0.217 8.29e- 1
 5 chas1         2.84      0.870       3.26  1.17e- 3
 6 nox         -18.8       3.85       -4.87  1.50e- 6
 7 rm            3.66      0.420       8.70  4.81e-17
 8 age           0.00361   0.0133      0.271 7.87e- 1
 9 dis          -1.49      0.202      -7.39  6.17e-13
10 rad           0.289     0.0669      4.33  1.84e- 5
11 tax          -0.0127    0.00380    -3.34  9.12e- 4
12 ptratio      -0.938     0.132      -7.09  4.63e-12
13 lstat        -0.552     0.0507    -10.9   6.39e-25</code></pre>
</div>
</div>
<p><br><br><br><br> We can see that most of the variables are significant. However, notably</p>
<blockquote class="blockquote">
<p><code>age</code> and <code>indus</code> are not significant predictors of <code>medv</code></p>
</blockquote>
<p>Is this true?</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-8_47e55812f0203648c67b633019b292a3">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(medv ~ age, df)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(lm(medv ~ age), col="red")</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>model_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> age, df)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model_age)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(model_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   31.0      0.999      31.0  6.81e-119
2 age           -0.123    0.0135     -9.14 1.57e- 18</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-9_19653b8dc0300196a994bc8944f90ca7">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(medv ~ indus, df)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(lm(medv ~ indus), col="red")</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>model_indus <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> indus, df)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(model_indus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   29.8      0.683       43.5 6.70e-173
2 indus         -0.648    0.0523     -12.4 4.90e- 31</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-10_a3f326d607584209f0283424c0d82910">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              crim         zn      indus        nox         rm        age
crim     1.0000000 -0.2004692  0.4065834  0.4209717 -0.2192467  0.3527343
zn      -0.2004692  1.0000000 -0.5338282 -0.5166037  0.3119906 -0.5695373
indus    0.4065834 -0.5338282  1.0000000  0.7636514 -0.3916759  0.6447785
nox      0.4209717 -0.5166037  0.7636514  1.0000000 -0.3021882  0.7314701
rm      -0.2192467  0.3119906 -0.3916759 -0.3021882  1.0000000 -0.2402649
age      0.3527343 -0.5695373  0.6447785  0.7314701 -0.2402649  1.0000000
dis     -0.3796701  0.6644082 -0.7080270 -0.7692301  0.2052462 -0.7478805
rad      0.6255051 -0.3119478  0.5951293  0.6114406 -0.2098467  0.4560225
tax      0.5827643 -0.3145633  0.7207602  0.6680232 -0.2920478  0.5064556
ptratio  0.2899456 -0.3916785  0.3832476  0.1889327 -0.3555015  0.2615150
lstat    0.4556215 -0.4129946  0.6037997  0.5908789 -0.6138083  0.6023385
medv    -0.3883046  0.3604453 -0.4837252 -0.4273208  0.6953599 -0.3769546
               dis        rad        tax    ptratio      lstat       medv
crim    -0.3796701  0.6255051  0.5827643  0.2899456  0.4556215 -0.3883046
zn       0.6644082 -0.3119478 -0.3145633 -0.3916785 -0.4129946  0.3604453
indus   -0.7080270  0.5951293  0.7207602  0.3832476  0.6037997 -0.4837252
nox     -0.7692301  0.6114406  0.6680232  0.1889327  0.5908789 -0.4273208
rm       0.2052462 -0.2098467 -0.2920478 -0.3555015 -0.6138083  0.6953599
age     -0.7478805  0.4560225  0.5064556  0.2615150  0.6023385 -0.3769546
dis      1.0000000 -0.4945879 -0.5344316 -0.2324705 -0.4969958  0.2499287
rad     -0.4945879  1.0000000  0.9102282  0.4647412  0.4886763 -0.3816262
tax     -0.5344316  0.9102282  1.0000000  0.4608530  0.5439934 -0.4685359
ptratio -0.2324705  0.4647412  0.4608530  1.0000000  0.3740443 -0.5077867
lstat   -0.4969958  0.4886763  0.5439934  0.3740443  1.0000000 -0.7376627
medv     0.2499287 -0.3816262 -0.4685359 -0.5077867 -0.7376627  1.0000000</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-11_3e6896ba85bbb0988e3adc670de08ad8">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(R, <span class="at">type=</span><span class="st">"upper"</span>, <span class="at">order=</span><span class="st">"hclust"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-12_c269a86dbd5fec0fd0612cafa64bcd66">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>new_cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">13</span>)]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(indus, nox, dis)))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   term        estimate std.error statistic  p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept) 21.7       4.22        5.14  4.01e- 7
 2 crim        -0.0919    0.0347     -2.65  8.38e- 3
 3 zn           0.00879   0.0127      0.694 4.88e- 1
 4 chas1        2.95      0.914       3.23  1.31e- 3
 5 rm           4.10      0.439       9.34  3.33e-19
 6 age          0.0209    0.0122      1.71  8.73e- 2
 7 rad          0.252     0.0679      3.71  2.31e- 4
 8 tax         -0.0124    0.00347    -3.58  3.71e- 4
 9 ptratio     -0.887     0.129      -6.86  2.03e-11
10 lstat       -0.574     0.0532    -10.8   1.55e-24</code></pre>
</div>
</div>
</section>
<section id="variance-inflation-factors" class="level2">
<h2 class="anchored" data-anchor-id="variance-inflation-factors">Variance Inflation Factors</h2>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-13_257fe61d30dcebc9a2a4c62ff5b1706f">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>vif_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., df)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(vif_model) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> x </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> crim </td>
   <td style="text-align:right;"> 1.767486 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> zn </td>
   <td style="text-align:right;"> 2.298459 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> indus </td>
   <td style="text-align:right;"> 3.987181 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> chas </td>
   <td style="text-align:right;"> 1.071168 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> nox </td>
   <td style="text-align:right;"> 4.369093 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rm </td>
   <td style="text-align:right;"> 1.912532 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:right;"> 3.088232 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dis </td>
   <td style="text-align:right;"> 3.954037 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> rad </td>
   <td style="text-align:right;"> 7.445301 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> tax </td>
   <td style="text-align:right;"> 9.002158 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ptratio </td>
   <td style="text-align:right;"> 1.797060 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lstat </td>
   <td style="text-align:right;"> 2.870776 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="stepwise-regression">Stepwise Regression</h2>
<p><br><br><br><br></p>
<hr>
<p>If we are given a full model</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots + \beta_p x_p + \epsilon
\]</span></p>
<p>Variable selection methods (i.e., forward/backward/forward-backward selection) try to find the best subset of variables by either:</p>
<ol type="1">
<li>Adding variables one at a time to <strong>include</strong> the variable which leads to the best model improvement (forward)</li>
<li>Removing variables one at a time to <strong>exclude</strong> the variable which leads to the least model degradation (backward)</li>
<li>Some combination of 1. and 2. (both)</li>
</ol>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-14_590701a4dbc1dee3e11de32de8d37cb4">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> <span class="dv">1</span>, df)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-15_697ced28b72e2f2f7fa41d86858d15bd">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>forward_model <span class="ot">&lt;-</span> <span class="fu">step</span>(null_model, <span class="at">direction =</span> <span class="st">"forward"</span>, <span class="at">scope=</span><span class="fu">formula</span>(full_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=2246.51
medv ~ 1

          Df Sum of Sq   RSS    AIC
+ lstat    1   23243.9 19472 1851.0
+ rm       1   20654.4 22062 1914.2
+ ptratio  1   11014.3 31702 2097.6
+ indus    1    9995.2 32721 2113.6
+ tax      1    9377.3 33339 2123.1
+ nox      1    7800.1 34916 2146.5
+ crim     1    6440.8 36276 2165.8
+ rad      1    6221.1 36495 2168.9
+ age      1    6069.8 36647 2171.0
+ zn       1    5549.7 37167 2178.1
+ dis      1    2668.2 40048 2215.9
+ chas     1    1312.1 41404 2232.7
&lt;none&gt;                 42716 2246.5

Step:  AIC=1851.01
medv ~ lstat

          Df Sum of Sq   RSS    AIC
+ rm       1    4033.1 15439 1735.6
+ ptratio  1    2670.1 16802 1778.4
+ chas     1     786.3 18686 1832.2
+ dis      1     772.4 18700 1832.5
+ age      1     304.3 19168 1845.0
+ tax      1     274.4 19198 1845.8
+ zn       1     160.3 19312 1848.8
+ crim     1     146.9 19325 1849.2
+ indus    1      98.7 19374 1850.4
&lt;none&gt;                 19472 1851.0
+ rad      1      25.1 19447 1852.4
+ nox      1       4.8 19468 1852.9

Step:  AIC=1735.58
medv ~ lstat + rm

          Df Sum of Sq   RSS    AIC
+ ptratio  1   1711.32 13728 1678.1
+ chas     1    548.53 14891 1719.3
+ tax      1    425.16 15014 1723.5
+ dis      1    351.15 15088 1725.9
+ crim     1    311.42 15128 1727.3
+ rad      1    180.45 15259 1731.6
+ indus    1     61.09 15378 1735.6
&lt;none&gt;                 15439 1735.6
+ zn       1     56.56 15383 1735.7
+ age      1     20.18 15419 1736.9
+ nox      1     14.90 15424 1737.1

Step:  AIC=1678.13
medv ~ lstat + rm + ptratio

        Df Sum of Sq   RSS    AIC
+ dis    1    499.08 13229 1661.4
+ chas   1    377.96 13350 1666.0
+ crim   1    122.52 13606 1675.6
+ age    1     66.24 13662 1677.7
&lt;none&gt;               13728 1678.1
+ tax    1     44.36 13684 1678.5
+ nox    1     24.81 13703 1679.2
+ zn     1     14.96 13713 1679.6
+ rad    1      6.07 13722 1679.9
+ indus  1      0.83 13727 1680.1

Step:  AIC=1661.39
medv ~ lstat + rm + ptratio + dis

        Df Sum of Sq   RSS    AIC
+ nox    1    759.56 12469 1633.5
+ chas   1    267.43 12962 1653.1
+ indus  1    242.65 12986 1654.0
+ tax    1    240.34 12989 1654.1
+ crim   1    233.54 12995 1654.4
+ zn     1    144.81 13084 1657.8
+ age    1     61.36 13168 1661.0
&lt;none&gt;               13229 1661.4
+ rad    1     22.40 13206 1662.5

Step:  AIC=1633.47
medv ~ lstat + rm + ptratio + dis + nox

        Df Sum of Sq   RSS    AIC
+ chas   1    328.27 12141 1622.0
+ zn     1    151.71 12318 1629.3
+ crim   1    141.43 12328 1629.7
+ rad    1     53.48 12416 1633.3
&lt;none&gt;               12469 1633.5
+ indus  1     17.10 12452 1634.8
+ tax    1     10.50 12459 1635.0
+ age    1      0.25 12469 1635.5

Step:  AIC=1621.97
medv ~ lstat + rm + ptratio + dis + nox + chas

        Df Sum of Sq   RSS    AIC
+ zn     1   164.406 11977 1617.1
+ crim   1   116.330 12025 1619.1
+ rad    1    58.556 12082 1621.5
&lt;none&gt;               12141 1622.0
+ indus  1    26.274 12115 1622.9
+ tax    1     4.187 12137 1623.8
+ age    1     2.331 12139 1623.9

Step:  AIC=1617.07
medv ~ lstat + rm + ptratio + dis + nox + chas + zn

        Df Sum of Sq   RSS    AIC
+ crim   1   170.902 11806 1611.8
&lt;none&gt;               11977 1617.1
+ tax    1    31.773 11945 1617.7
+ rad    1    28.311 11948 1617.9
+ indus  1    27.377 11949 1617.9
+ age    1     0.071 11977 1619.1

Step:  AIC=1611.8
medv ~ lstat + rm + ptratio + dis + nox + chas + zn + crim

        Df Sum of Sq   RSS    AIC
+ rad    1   155.006 11651 1607.1
&lt;none&gt;               11806 1611.8
+ indus  1    24.957 11781 1612.7
+ tax    1     1.418 11804 1613.7
+ age    1     0.178 11806 1613.8

Step:  AIC=1607.11
medv ~ lstat + rm + ptratio + dis + nox + chas + zn + crim + 
    rad

        Df Sum of Sq   RSS    AIC
+ tax    1   298.573 11352 1596.0
&lt;none&gt;               11651 1607.1
+ indus  1    44.346 11606 1607.2
+ age    1     0.581 11650 1609.1

Step:  AIC=1595.98
medv ~ lstat + rm + ptratio + dis + nox + chas + zn + crim + 
    rad + tax

        Df Sum of Sq   RSS    AIC
&lt;none&gt;               11352 1596.0
+ age    1    1.6865 11350 1597.9
+ indus  1    1.0784 11351 1597.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(forward_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   term        estimate std.error statistic  p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.5      4.90         8.45 3.18e-16
 2 lstat        -0.547    0.0474     -11.5  2.29e-27
 3 rm            3.67     0.409        8.98 5.78e-18
 4 ptratio      -0.931    0.130       -7.14 3.39e-12
 5 dis          -1.52     0.188       -8.08 5.08e-15
 6 nox         -18.3      3.57        -5.12 4.33e- 7
 7 chas1         2.87     0.863        3.33 9.35e- 4
 8 zn            0.0462   0.0137       3.38 7.87e- 4
 9 crim         -0.122    0.0329      -3.70 2.44e- 4
10 rad           0.284    0.0639       4.44 1.11e- 5
11 tax          -0.0123   0.00341     -3.61 3.40e- 4</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-16_d2c145ad09017e741f4fac637f0431fb">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>backward_model <span class="ot">&lt;-</span> <span class="fu">step</span>(full_model, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">scope=</span><span class="fu">formula</span>(full_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1599.85
medv ~ crim + zn + indus + chas + nox + rm + age + dis + rad + 
    tax + ptratio + lstat

          Df Sum of Sq   RSS    AIC
- indus    1      1.08 11350 1597.9
- age      1      1.69 11351 1597.9
&lt;none&gt;                 11349 1599.8
- chas     1    245.31 11595 1608.7
- tax      1    256.28 11606 1609.2
- zn       1    263.59 11613 1609.5
- crim     1    311.49 11661 1611.6
- rad      1    430.71 11780 1616.7
- nox      1    546.10 11896 1621.6
- ptratio  1   1157.70 12507 1647.0
- dis      1   1258.52 12608 1651.1
- rm       1   1744.36 13094 1670.2
- lstat    1   2733.54 14083 1707.0

Step:  AIC=1597.9
medv ~ crim + zn + chas + nox + rm + age + dis + rad + tax + 
    ptratio + lstat

          Df Sum of Sq   RSS    AIC
- age      1      1.69 11352 1596.0
&lt;none&gt;                 11350 1597.9
- chas     1    251.21 11602 1607.0
- zn       1    262.99 11614 1607.5
- tax      1    299.68 11650 1609.1
- crim     1    313.07 11664 1609.7
- rad      1    453.61 11804 1615.7
- nox      1    574.23 11925 1620.9
- ptratio  1   1168.01 12518 1645.5
- dis      1   1333.19 12684 1652.1
- rm       1   1750.50 13101 1668.5
- lstat    1   2743.21 14094 1705.4

Step:  AIC=1595.98
medv ~ crim + zn + chas + nox + rm + dis + rad + tax + ptratio + 
    lstat

          Df Sum of Sq   RSS    AIC
&lt;none&gt;                 11352 1596.0
- chas     1    254.21 11606 1605.2
- zn       1    261.75 11614 1605.5
- tax      1    298.57 11651 1607.1
- crim     1    313.27 11666 1607.8
- rad      1    452.16 11804 1613.7
- nox      1    601.74 11954 1620.1
- ptratio  1   1168.51 12521 1643.5
- dis      1   1496.35 12848 1656.6
- rm       1   1848.38 13201 1670.3
- lstat    1   3043.23 14395 1714.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(backward_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   term        estimate std.error statistic  p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.5      4.90         8.45 3.18e-16
 2 crim         -0.122    0.0329      -3.70 2.44e- 4
 3 zn            0.0462   0.0137       3.38 7.87e- 4
 4 chas1         2.87     0.863        3.33 9.35e- 4
 5 nox         -18.3      3.57        -5.12 4.33e- 7
 6 rm            3.67     0.409        8.98 5.78e-18
 7 dis          -1.52     0.188       -8.08 5.08e-15
 8 rad           0.284    0.0639       4.44 1.11e- 5
 9 tax          -0.0123   0.00341     -3.61 3.40e- 4
10 ptratio      -0.931    0.130       -7.14 3.39e-12
11 lstat        -0.547    0.0474     -11.5  2.29e-27</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-17_7100137ff31a2d108fbf1d7bb0605f0b">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>selected_model <span class="ot">&lt;-</span> <span class="fu">step</span>(full_model, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">scope=</span><span class="fu">formula</span>(full_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1599.85
medv ~ crim + zn + indus + chas + nox + rm + age + dis + rad + 
    tax + ptratio + lstat

          Df Sum of Sq   RSS    AIC
- indus    1      1.08 11350 1597.9
- age      1      1.69 11351 1597.9
&lt;none&gt;                 11349 1599.8
- chas     1    245.31 11595 1608.7
- tax      1    256.28 11606 1609.2
- zn       1    263.59 11613 1609.5
- crim     1    311.49 11661 1611.6
- rad      1    430.71 11780 1616.7
- nox      1    546.10 11896 1621.6
- ptratio  1   1157.70 12507 1647.0
- dis      1   1258.52 12608 1651.1
- rm       1   1744.36 13094 1670.2
- lstat    1   2733.54 14083 1707.0

Step:  AIC=1597.9
medv ~ crim + zn + chas + nox + rm + age + dis + rad + tax + 
    ptratio + lstat

          Df Sum of Sq   RSS    AIC
- age      1      1.69 11352 1596.0
&lt;none&gt;                 11350 1597.9
+ indus    1      1.08 11349 1599.8
- chas     1    251.21 11602 1607.0
- zn       1    262.99 11614 1607.5
- tax      1    299.68 11650 1609.1
- crim     1    313.07 11664 1609.7
- rad      1    453.61 11804 1615.7
- nox      1    574.23 11925 1620.9
- ptratio  1   1168.01 12518 1645.5
- dis      1   1333.19 12684 1652.1
- rm       1   1750.50 13101 1668.5
- lstat    1   2743.21 14094 1705.4

Step:  AIC=1595.98
medv ~ crim + zn + chas + nox + rm + dis + rad + tax + ptratio + 
    lstat

          Df Sum of Sq   RSS    AIC
&lt;none&gt;                 11352 1596.0
+ age      1      1.69 11350 1597.9
+ indus    1      1.08 11351 1597.9
- chas     1    254.21 11606 1605.2
- zn       1    261.75 11614 1605.5
- tax      1    298.57 11651 1607.1
- crim     1    313.27 11666 1607.8
- rad      1    452.16 11804 1613.7
- nox      1    601.74 11954 1620.1
- ptratio  1   1168.51 12521 1643.5
- dis      1   1496.35 12848 1656.6
- rm       1   1848.38 13201 1670.3
- lstat    1   3043.23 14395 1714.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(selected_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   term        estimate std.error statistic  p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.5      4.90         8.45 3.18e-16
 2 crim         -0.122    0.0329      -3.70 2.44e- 4
 3 zn            0.0462   0.0137       3.38 7.87e- 4
 4 chas1         2.87     0.863        3.33 9.35e- 4
 5 nox         -18.3      3.57        -5.12 4.33e- 7
 6 rm            3.67     0.409        8.98 5.78e-18
 7 dis          -1.52     0.188       -8.08 5.08e-15
 8 rad           0.284    0.0639       4.44 1.11e- 5
 9 tax          -0.0123   0.00341     -3.61 3.40e- 4
10 ptratio      -0.931    0.130       -7.14 3.39e-12
11 lstat        -0.547    0.0474     -11.5  2.29e-27</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-18_9dc9bd1e8e39c41a6b4245fd916750ce">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 5
   term         estimate std.error statistic  p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.6       4.94        8.43  3.79e-16
 2 crim         -0.121     0.0330     -3.68  2.61e- 4
 3 zn            0.0470    0.0139      3.38  7.72e- 4
 4 indus         0.0135    0.0621      0.217 8.29e- 1
 5 chas1         2.84      0.870       3.26  1.17e- 3
 6 nox         -18.8       3.85       -4.87  1.50e- 6
 7 rm            3.66      0.420       8.70  4.81e-17
 8 age           0.00361   0.0133      0.271 7.87e- 1
 9 dis          -1.49      0.202      -7.39  6.17e-13
10 rad           0.289     0.0669      4.33  1.84e- 5
11 tax          -0.0127    0.00380    -3.34  9.12e- 4
12 ptratio      -0.938     0.132      -7.09  4.63e-12
13 lstat        -0.552     0.0507    -10.9   6.39e-25</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-19_fe2b6f4bb6e18190ed1f1f855e643b28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(selected_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   term        estimate std.error statistic  p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  41.5      4.90         8.45 3.18e-16
 2 crim         -0.122    0.0329      -3.70 2.44e- 4
 3 zn            0.0462   0.0137       3.38 7.87e- 4
 4 chas1         2.87     0.863        3.33 9.35e- 4
 5 nox         -18.3      3.57        -5.12 4.33e- 7
 6 rm            3.67     0.409        8.98 5.78e-18
 7 dis          -1.52     0.188       -8.08 5.08e-15
 8 rad           0.284    0.0639       4.44 1.11e- 5
 9 tax          -0.0123   0.00341     -3.61 3.40e- 4
10 ptratio      -0.931    0.130       -7.14 3.39e-12
11 lstat        -0.547    0.0474     -11.5  2.29e-27</code></pre>
</div>
</div>
<hr>
<p><br><br><br><br> <br><br><br><br></p>
<hr>
</section>
</section>
<section id="tue-feb-21" class="level1">
<h1>Tue, Feb 21</h1>
<section id="regularization-shrinkage-estimators" class="level2">
<h2 class="anchored" data-anchor-id="regularization-shrinkage-estimators">Regularization / Shrinkage Estimators</h2>
<p>Regularization achieves a similar objective using a slightly different strategy. To see this, first let’s look at the objective function of the <strong>standard regression</strong> task:</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots + \beta_p x_p + \epsilon
\]</span></p>
<p>Recall that the least-squares objective selects the model with the smallest residual standard error, i.e.,</p>
<p><span class="math display">\[
L(\beta_0, \beta_2, \dots, \beta_p) = SS_{Res} = \sum_{i=1}^n (y_i - \beta_0 - \beta_1 x_{1, i} - \dots \beta_p x_{p, i})^2
\]</span></p>
<p>The solution to this problem is denoted as follows:</p>
<p><span class="math display">\[
(b_0, b_1, b_2, \dots, b_p) = \mathop{\arg\min}\limits_{\beta_1 \dots \beta_p} L(\beta_0, \beta_2, \dots, \beta_p)
\]</span></p>
<p>If we want to select only a subset of these variables in our final model, we can include a penalty term <span class="math display">\[p_\lambda(\beta_1, \dots, \beta_p)\]</span></p>
<p>which <strong>favours solutions which select smaller subsets of the variables.</strong> In this setting, the objective function becomes</p>
<p><span class="math display">\[
\boxed{
L_\lambda(\beta_0, \beta_1, \dots, \beta_p) = L(\beta_0, \beta_2, \dots, \beta_p) + p_\lambda(\beta_1, \dots, \beta_p)
}
\]</span></p>
<p>The most common penalty functions include:</p>
<ol type="1">
<li>Ridge regression where <span class="math display">\[
p_\lambda = \lambda \|{\beta}\|^2_2 = \lambda \times (\beta_1^2 + \beta_2^2 + \dots + \beta_p^2)
\]</span></li>
<li>LASSO regression where <span class="math display">\[
p_\lambda = \lambda \|{\beta}\|_1 = \lambda \times (|\beta_1| + |\beta_2| + \dots + |\beta_p|)
\]</span></li>
<li>General case in <code>glmnet()</code> <span class="math display">\[
p_\lambda = \lambda \times \Bigg( \alpha \|\beta\|_1 + \frac{1-\alpha}{2} \|\beta\|_2^2 \Bigg)
\]</span> here <code>alpha=1</code> corresponds to LASSO and <code>alpha=0</code> corresponds to ridge regression.</li>
</ol>
<p>⚠️</p>
<p>In both cases, we can see that we want to find a solution which: * Minimizes <span class="math inline">\(SS_{Res}\)</span>, and * Minimized <span class="math inline">\(p_\lambda\)</span>, which means we want to find a solution which favours <strong>sparser</strong> solutions</p>
<p>In <code>R</code> the <code>glmnet</code> library exports functions for performing penalized regression</p>
<p>⚠️</p>
</section>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">LASSO</h2>
<p>Unlike <code>lm()</code> the <code>glmnet()</code> function doesn’t take in a formula. (Have a look at its documentation).</p>
<p>glmnet(X, y) X: matrix of the covariates y: response vector</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-20_628c974fd05d91c847e2d76a723f75b4">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(full_model)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     crim zn indus chas1   nox    rm  age    dis rad tax ptratio lstat
1 0.00632 18  2.31     0 0.538 6.575 65.2 4.0900   1 296    15.3  4.98
2 0.02731  0  7.07     0 0.469 6.421 78.9 4.9671   2 242    17.8  9.14
3 0.02729  0  7.07     0 0.469 7.185 61.1 4.9671   2 242    17.8  4.03
4 0.03237  0  2.18     0 0.458 6.998 45.8 6.0622   3 222    18.7  2.94
5 0.06905  0  2.18     0 0.458 7.147 54.2 6.0622   3 222    18.7  5.33
6 0.02985  0  2.18     0 0.458 6.430 58.7 6.0622   3 222    18.7  5.21</code></pre>
</div>
</div>
<p>As an extra pre-processing step, it’s always recommended to <code>scale</code> all the numeric entries of the matrix <code>X</code> so that they are on the same scale</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-21_7a4f514f037dedb2faab83d53c989073">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>all_cols <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(X)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>drop_scale <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>include_scale <span class="ot">&lt;-</span> all_cols[<span class="sc">-</span>drop_scale]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> include_scale){ X[, i] <span class="ot">&lt;-</span> <span class="fu">scale</span>(X[, i]) }</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        crim         zn      indus chas1        nox        rm        age
1 -0.4193669  0.2845483 -1.2866362     0 -0.1440749 0.4132629 -0.1198948
2 -0.4169267 -0.4872402 -0.5927944     0 -0.7395304 0.1940824  0.3668034
3 -0.4169290 -0.4872402 -0.5927944     0 -0.7395304 1.2814456 -0.2655490
4 -0.4163384 -0.4872402 -1.3055857     0 -0.8344581 1.0152978 -0.8090878
5 -0.4120741 -0.4872402 -1.3055857     0 -0.8344581 1.2273620 -0.5106743
6 -0.4166314 -0.4872402 -1.3055857     0 -0.8344581 0.2068916 -0.3508100
       dis        rad        tax    ptratio      lstat
1 0.140075 -0.9818712 -0.6659492 -1.4575580 -1.0744990
2 0.556609 -0.8670245 -0.9863534 -0.3027945 -0.4919525
3 0.556609 -0.8670245 -0.9863534 -0.3027945 -1.2075324
4 1.076671 -0.7521778 -1.1050216  0.1129203 -1.3601708
5 1.076671 -0.7521778 -1.1050216  0.1129203 -1.0254866
6 1.076671 -0.7521778 -1.1050216  0.1129203 -1.0422909</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-22_77b0d11591309624dc3390139d57e68c">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> df<span class="sc">$</span>medv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-23_c5fd3bb183a771d4d86b79100fa2513c">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-24_b70ed5d52d7436f4db6f40cbdd5aa354">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-25_632e2871f4b1fe2124a8395507ffb5fc">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">^</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="at">length.out=</span><span class="dv">1000</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambdas)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-26_e9459d13e31d87a933590157f7a5c819">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[<span class="fu">which</span>(<span class="fu">abs</span>(lasso_coef) <span class="sc">&gt;</span> <span class="dv">0</span>)][<span class="sc">-</span><span class="dv">1</span>] <span class="co"># exclude the intercept term</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>lasso_coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13 x 1 sparse Matrix of class "dgCMatrix"
                     s1
(Intercept) 22.43194228
crim        -0.17203189
zn           .         
indus        .         
chas1        1.45820588
nox          .         
rm           2.89109177
age          .         
dis          .         
rad          .         
tax         -0.02102195
ptratio     -1.56343559
lstat       -3.73950846</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selected_vars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-27_3416723c99cc7405375e491aa99f50db">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># full_model &lt;- lm(medv ~ ., data = df)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>lasso_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> X[, selected_vars])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-28_9ce7c371fda6a94b39292af2660913bc">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(lasso_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  term                      estimate std.error statistic   p.value
  &lt;chr&gt;                        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)                 22.3       0.237    93.9   2.44e-319
2 X[, selected_vars]crim      -0.468     0.289    -1.62  1.06e-  1
3 X[, selected_vars]chas1      3.41      0.911     3.74  2.06e-  4
4 X[, selected_vars]rm         3.20      0.298    10.7   2.99e- 24
5 X[, selected_vars]tax       -0.184     0.322    -0.572 5.67e-  1
6 X[, selected_vars]ptratio   -1.79      0.269    -6.66  7.38e- 11
7 X[, selected_vars]lstat     -3.79      0.339   -11.2   3.93e- 26</code></pre>
</div>
</div>
<hr>
<p><br><br><br><br><br><br></p>
</section>
</section>
<section id="gradient-descent" class="level1">
<h1>Gradient Descent</h1>
<section id="a-general-recipe-for-fitting-models" class="level4">
<h4 class="anchored" data-anchor-id="a-general-recipe-for-fitting-models">A general recipe for fitting models</h4>
<p>Recall that the solution to a regression problem is given by</p>
<p><span class="math display">\[
(b_1, b_2, \dots, b_p) = \mathop{\arg\min}\limits_{\beta_1 \dots \beta_p} L(\beta_0, \beta_2, \dots, \beta_p)
\]</span></p>
<p>where <span class="math inline">\(L(\beta_0, \beta_2, \dots, \beta_p)\)</span> is referred to as the <strong>loss function</strong>. If we want to find the values of <span class="math inline">\((b_0, b_1, \dots, b_p)\)</span> which minimize <span class="math inline">\(L()\)</span>, then using the general principle from calculus, we are interested in looking for values such that</p>
<p><span class="math display">\[
\boxed{
\begin{aligned}
\frac{d}{d\beta_0} L(\beta_0, \beta_2, \dots, \beta_p) &amp;= 0\\ \\
\frac{d}{d\beta_1} L(\beta_0, \beta_2, \dots, \beta_p) &amp;= 0\\ \\
\frac{d}{d\beta_2} L(\beta_0, \beta_2, \dots, \beta_p) &amp;= 0\\ \\
\vdots \\ \\
\frac{d}{d\beta_p} L(\beta_0, \beta_2, \dots, \beta_p) &amp;= 0
\end{aligned}
}
\]</span></p>
<p>In the case of linear regression, the derivates can be computed by hand, and there exists a <em><strong>closed form solutions</strong></em> to the above system of equations.</p>
<p>However, in many other models, we don’t have a method for obtaining closed form solutions. In such cases, the general strategy is as follows:</p>
<div class="alert alert-block alert-success">
<ol type="1">
<li><p>Compute the gradient <span class="math display">\[
\nabla L(\beta_0, \beta_1, \dots, \beta_p)  = \Bigg( \frac{d L}{d\beta_0}, \frac{d L}{d\beta_1}, \dots, \frac{d L}{d\beta_p} \Bigg)
\]</span></p></li>
<li><p>Choose a step size <span class="math inline">\(\eta \in (0, 1)\)</span></p></li>
<li><p>Perform gradient descent <span class="math display">\[
(b'_0, b'_1, b'_2, \dots, b'_p) = (b_0, b_1, b_2, \dots, b_p)  - \eta \cdot \nabla L(\beta_0, \beta_1, \dots, \beta_p)
\]</span></p>
<p>or, in component form</p></li>
</ol>
<p><span class="math display">\[
\boxed{
\begin{aligned}
b'_0  &amp;\leftarrow b_0 -  \Big(\eta \cdot \frac{dL}{d\beta_0} \Big)\\ \\
b'_1  &amp;\leftarrow b_1 -  \Big(\eta \cdot \frac{dL}{d\beta_1} \Big)\\ \\
\vdots \\ \\
b'_p  &amp;\leftarrow b_p -  \Big(\eta \cdot \frac{dL}{d\beta_p} \Big)
\end{aligned}
}
\]</span></p>
<ol start="4" type="1">
<li>Stop when the relative improvement is small, e.g., <span class="math display">\[
|L(b'_0, b'_1, b'_2, \dots, b'_p) - L(b_0, b_1, b_2, \dots, b_p)| &lt; 10^{-9}
\]</span></li>
</ol>
</div>
<p>Let’s see this in action for the following example for performing linear regression with the <code>cars</code> dataset</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-29_65a4b9592f234ae3e83dc35158bc5ec2">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach(cars)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(cars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
speed    4    4    7    7    8    9   10   10   10    11    11    12    12
dist     2   10    4   22   16   10   18   26   34    17    28    14    20
      [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
speed    12    12    13    13    13    13    14    14    14    14    15    15
dist     24    28    26    34    34    46    26    36    60    80    20    26
      [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
speed    15    16    16    17    17    17    18    18    18    18    19    19
dist     54    32    40    32    40    50    42    56    76    84    36    46
      [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]
speed    19    20    20    20    20    20    22    23    24    24    24    24
dist     68    32    48    52    56    64    66    54    70    92    93   120
      [,50]
speed    25
dist     85</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-30_d2d003fd64fc7746be2b34aa935e8e6c">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cars) <span class="sc">+</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed, <span class="at">y=</span>dist)) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed, <span class="at">y=</span>dist), <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-31_a44245c387067643f6112204450b4f42">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the loss function</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>Loss <span class="ot">&lt;-</span> <span class="cf">function</span>(b, x, y){</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    squares <span class="ot">&lt;-</span> (y <span class="sc">-</span> b[<span class="dv">1</span>] <span class="sc">-</span> b[<span class="dv">2</span>] <span class="sc">*</span> x)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">sum</span>(squares) )</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Loss</span>(b, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 267453.8</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-32_e07dc225b7ec0b8edff312a3b744d3f8">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to compute the gradients</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>grad <span class="ot">&lt;-</span> <span class="cf">function</span>(b, Loss, x, y, <span class="at">eps=</span><span class="fl">1e-5</span>){</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    b0_up <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>] <span class="sc">+</span> eps, b[<span class="dv">2</span>]), x, y)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    b0_dn <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>] <span class="sc">-</span> eps, b[<span class="dv">2</span>]), x, y)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    b1_up <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>], b[<span class="dv">2</span>] <span class="sc">+</span> eps), x, y)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    b1_dn <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>], b[<span class="dv">2</span>] <span class="sc">-</span> eps), x, y)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    grad_b0_L <span class="ot">&lt;-</span> (b0_up <span class="sc">-</span> b0_dn) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> eps)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    grad_b1_L <span class="ot">&lt;-</span> (b1_up <span class="sc">-</span> b1_dn) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> eps)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">c</span>(grad_b0_L, grad_b1_L) )</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="fu">grad</span>(b, Loss, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   -6559.517 -115999.308</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-33_d8588661d4ca3df725136dc3a75ab311">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, steps)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fl">1e-7</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="dv">2</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>steps){</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> b <span class="sc">-</span> eta <span class="sc">*</span> <span class="fu">grad</span>(b, Loss, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    L[i] <span class="ot">&lt;-</span> <span class="fu">Loss</span>(b, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-34_46d2e060a5db755d8fdf585535c2c9f0">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">12</span>, <span class="at">repr.plot.height=</span><span class="dv">7</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the final result</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dist <span class="sc">~</span> speed, cars, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">main=</span><span class="st">"Fitted Line"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(b, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the change in loss function value</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L, <span class="at">type=</span><span class="st">"b"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"dodgerblue"</span>, <span class="at">main=</span><span class="st">"Loss value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-35_4e9f4aa36e8328b2aabfc585bd88f31d">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">8</span>, <span class="at">repr.plot.height=</span><span class="dv">5</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, steps)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fl">1e-7</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="dv">2</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>steps){</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> b <span class="sc">-</span> eta <span class="sc">*</span> <span class="fu">grad</span>(b, Loss, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    L[i] <span class="ot">&lt;-</span> <span class="fu">Loss</span>(b, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the final result</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(dist <span class="sc">~</span> speed, cars, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">main=</span><span class="fu">paste</span>(<span class="st">"Fitted Line iter="</span>, i))</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abline</span>(b, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the change in loss function value</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(L, <span class="at">type=</span><span class="st">"b"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"dodgerblue"</span>, <span class="at">main=</span><span class="st">"Loss value"</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-12.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-13.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-14.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-15.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-16.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-17.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-18.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-19.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-35-20.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><br><br><br></p>
</section>
<section id="automatic-differentiation" class="level2">
<h2 class="anchored" data-anchor-id="automatic-differentiation">Automatic differentiation</h2>
<p>The cornerstone of modern machine learning and data-science is to be able to perform <strong>automatic differentiation</strong>, i.e., being able to compute the gradients for <strong>any</strong> function without the need to solve tedious calculus problems. For the more advanced parts of the course (e.g., neural networks), we will be using automatic differentiation libraries to perform gradient descent.</p>
<p>While there are several libraries for performing these tasks, we will be using the <code>pyTorch</code> library for this. The installation procedure can be found <a href="https://cran.r-project.org/web/packages/torch/vignettes/installation.html">here</a></p>
<p>The basic steps are:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"torch"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(torch)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>torch<span class="sc">::</span><span class="fu">torch_install</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
=======
</div>
<p><br><br><br><br></p>
<hr>
</section>
</section>
<section id="thu-feb-23" class="level1">
<h1>Thu, Feb 23</h1>
<p>In the last class we looked at the following <strong>numerical</strong> implementation of gradient descent in R</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-3_1b0479453d2eb96e6f82de4cf61507d4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cars<span class="sc">$</span>speed</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> cars<span class="sc">$</span>dist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-4_15fc7ae71bee959fcc767f263e70469f">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the loss function</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Loss <span class="ot">&lt;-</span> <span class="cf">function</span>(b, x, y){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    squares <span class="ot">&lt;-</span> (y <span class="sc">-</span> b[<span class="dv">1</span>] <span class="sc">-</span> b[<span class="dv">2</span>] <span class="sc">*</span> x)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">mean</span>(squares) )</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Loss</span>(b, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5402.536</code></pre>
</div>
</div>
<p>This is the <strong>numerical</strong> gradient function we looked at:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-5_4172e18f4224cb261fe02c99af171f9d">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to compute the gradients</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>grad <span class="ot">&lt;-</span> <span class="cf">function</span>(b, Loss, x, y, <span class="at">eps=</span><span class="fl">1e-5</span>){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    b0_up <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>] <span class="sc">+</span> eps, b[<span class="dv">2</span>]), x, y)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    b0_dn <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>] <span class="sc">-</span> eps, b[<span class="dv">2</span>]), x, y)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    b1_up <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>], b[<span class="dv">2</span>] <span class="sc">+</span> eps), x, y)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    b1_dn <span class="ot">&lt;-</span> <span class="fu">Loss</span>( <span class="fu">c</span>(b[<span class="dv">1</span>], b[<span class="dv">2</span>] <span class="sc">-</span> eps), x, y)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    grad_b0_L <span class="ot">&lt;-</span> (b0_up <span class="sc">-</span> b0_dn) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> eps)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    grad_b1_L <span class="ot">&lt;-</span> (b1_up <span class="sc">-</span> b1_dn) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> eps)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">c</span>(grad_b0_L, grad_b1_L) )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">grad</span>(b, Loss, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  -132.3569 -2333.6407</code></pre>
</div>
</div>
<p>The gradient descent implementation is below:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-6_534826d42d7fe5d35a89db26936d28c6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="dv">9999</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>L_numeric <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, steps)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fl">1e-4</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>b_numeric <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.0</span>, <span class="dv">2</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>steps){</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    b_numeric <span class="ot">&lt;-</span> b_numeric <span class="sc">-</span> eta <span class="sc">*</span> <span class="fu">grad</span>(b_numeric, Loss, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    L_numeric[i] <span class="ot">&lt;-</span> <span class="fu">Loss</span>(b_numeric, cars<span class="sc">$</span>speed, cars<span class="sc">$</span>dist)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">||</span> i <span class="sc">%%</span> <span class="dv">1000</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Iteration: %s</span><span class="sc">\t</span><span class="st"> Loss value: %s</span><span class="sc">\n</span><span class="st">"</span>, i, L_numeric[i]))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1     Loss value: 2266.69206282174
Iteration: 2     Loss value: 2059.23910669384
Iteration: 3     Loss value: 1873.22918303142
Iteration: 4     Loss value: 1706.44585378992
Iteration: 5     Loss value: 1556.90178087535
Iteration: 6     Loss value: 1422.815045446
Iteration: 7     Loss value: 1302.58791495713
Iteration: 8     Loss value: 1194.78780492565
Iteration: 9     Loss value: 1098.13020855732
Iteration: 10    Loss value: 1011.46339084888
Iteration: 1000  Loss value: 258.373721118606
Iteration: 2000  Loss value: 257.10759589046
Iteration: 3000  Loss value: 255.892681655669
Iteration: 4000  Loss value: 254.726907082124
Iteration: 5000  Loss value: 253.608284616954
Iteration: 6000  Loss value: 252.534907097824
Iteration: 7000  Loss value: 251.504944501478
Iteration: 8000  Loss value: 250.516640823636
Iteration: 9000  Loss value: 249.568311085141</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-7_fc82f871e4704f3435148326dd05b391">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">12</span>, <span class="at">repr.plot.height=</span><span class="dv">7</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(b_numeric, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L_numeric, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"dodgerblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><br><br><br></p>
<section id="automatic-differentiation" class="level2">
<h2 class="anchored" data-anchor-id="automatic-differentiation">Automatic differentiation</h2>
<p>The cornerstone of modern machine learning and data-science is to be able to perform <strong>automatic differentiation</strong>, i.e., being able to compute the gradients for <strong>any</strong> function without the need to solve tedious calculus problems. For the more advanced parts of the course (e.g., neural networks), we will be using automatic differentiation libraries to perform gradient descent.</p>
<p>While there are several libraries for performing these tasks, we will be using the <code>pyTorch</code> library for this. The installation procedure can be found <a href="https://cran.r-project.org/web/packages/torch/vignettes/installation.html">here</a></p>
<p>The basic steps are:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="st">"torch"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(torch)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>torch<span class="sc">::</span><span class="fu">install_torch</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example 1:</h3>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-8_8063b66295723506ba42435b0285891c">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">requires_grad=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.1573
 0.2418
-0.5526
 0.5163
-0.2973
[ CPUFloatType{5,1} ][ requires_grad = TRUE ]</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-9_d933128a5c7bc429e1d188c58d1c48fe">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">torch_norm</span>(x)<span class="sc">^</span><span class="dv">10</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">f</span>(x)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
0.227254
[ CPUFloatType{} ][ grad_fn = &lt;PowBackward0&gt; ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>y<span class="sc">$</span><span class="fu">backward</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\frac{dy}{dx}
\]</span></p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-10_4f04b19c1ab8540bf0f22213b31c26f6">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>grad</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.4808
 0.7391
-1.6889
 1.5781
-0.9086
[ CPUFloatType{5,1} ]</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-11_59de2ef75c5a08fdbb3c4bd843d7febd">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">5</span> <span class="sc">*</span> <span class="fu">torch_norm</span>(x)<span class="sc">^</span><span class="dv">8</span>) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0.4808
 0.7391
-1.6889
 1.5781
-0.9086
[ CPUFloatType{5,1} ][ grad_fn = &lt;MulBackward0&gt; ]</code></pre>
</div>
</div>
<hr>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example 2:</h3>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-12_83d283d630f0b4aeebfbd812b4181e9a">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">requires_grad=</span>T)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">torch_randn</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">requires_grad=</span>T)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
torch_tensor
-1.8044
-0.6929
-1.3656
-1.1592
-1.0987
-0.8194
 0.9497
 1.2981
 0.7077
 1.1886
[ CPUFloatType{10,1} ][ requires_grad = TRUE ]

[[2]]
torch_tensor
 1.8385
 0.6366
-0.0369
-0.6712
 0.5166
 0.2852
 0.2148
-0.2420
-0.8814
 0.6577
[ CPUFloatType{10,1} ][ requires_grad = TRUE ]</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-13_d7a6de65f7a5955f43d337dba05c1dee">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(x <span class="sc">*</span> y)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">f</span>(x, y)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
-3.68342
[ CPUFloatType{} ][ grad_fn = &lt;SumBackward0&gt; ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span><span class="fu">backward</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-14_4cf0263bc843f922e094d7627b13d737">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(x<span class="sc">$</span>grad, y<span class="sc">$</span>grad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
torch_tensor
 1.8385
 0.6366
-0.0369
-0.6712
 0.5166
 0.2852
 0.2148
-0.2420
-0.8814
 0.6577
[ CPUFloatType{10,1} ]

[[2]]
torch_tensor
-1.8044
-0.6929
-1.3656
-1.1592
-1.0987
-0.8194
 0.9497
 1.2981
 0.7077
 1.1886
[ CPUFloatType{10,1} ]</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-15_84f50afd41ac056d160ba84efc4c2468">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(x <span class="sc">-</span> y<span class="sc">$</span>grad, y <span class="sc">-</span> x<span class="sc">$</span>grad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
torch_tensor
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
[ CPUFloatType{10,1} ][ grad_fn = &lt;SubBackward0&gt; ]

[[2]]
torch_tensor
 0
 0
 0
 0
 0
 0
 0
 0
 0
 0
[ CPUFloatType{10,1} ][ grad_fn = &lt;SubBackward0&gt; ]</code></pre>
</div>
</div>
<hr>
</section>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">Example 3:</h3>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-16_b58d82cfa3564518f011a69a2a05bc3c">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(cars<span class="sc">$</span>speed, <span class="at">dtype =</span> <span class="fu">torch_float</span>())</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(cars<span class="sc">$</span>dist, <span class="at">dtype =</span> <span class="fu">torch_float</span>())</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-17_3f890f19a08010f75d0481d08a82f943">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">torch_zeros</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">dtype=</span><span class="fu">torch_float</span>(), <span class="at">requires_grad =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch_tensor
 0
 0
[ CPUFloatType{2,1} ][ requires_grad = TRUE ]</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-18_728af8dc17173904514b29c7445659bc">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>loss <span class="ot">&lt;-</span> <span class="fu">nn_mse_loss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-19_57de4c82421c55c226a32f1f49123e3a">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">torch_zeros</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">dtype=</span><span class="fu">torch_float</span>(), <span class="at">requires_grad =</span> <span class="cn">TRUE</span>) <span class="co"># Initializing variables</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># Specifying the number of optimization steps</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, steps) <span class="co"># Keeping track of the loss</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># Specifying the learning rate and the optimizer</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>optimizer <span class="ot">&lt;-</span> <span class="fu">optim_adam</span>(b, <span class="at">lr=</span>eta)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient descent optimization over here</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>steps){</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="ot">&lt;-</span> x <span class="sc">*</span> b[<span class="dv">2</span>] <span class="sc">+</span> b[<span class="dv">1</span>]</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">&lt;-</span> <span class="fu">loss</span>(y_hat, y)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    L[i] <span class="ot">&lt;-</span> l<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    l<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="sc">$</span><span class="fu">step</span>()</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">||</span> i <span class="sc">%%</span> <span class="dv">200</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Iteration: %s</span><span class="sc">\t</span><span class="st"> Loss value: %s</span><span class="sc">\n</span><span class="st">"</span>, i, L[i]))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1     Loss value: 2498.06005859375
Iteration: 2     Loss value: 1759.53002929688
Iteration: 3     Loss value: 1174.45300292969
Iteration: 4     Loss value: 742.353759765625
Iteration: 5     Loss value: 457.703643798828
Iteration: 6     Loss value: 307.684936523438
Iteration: 7     Loss value: 270.263397216797
Iteration: 8     Loss value: 314.067993164062
Iteration: 9     Loss value: 401.761566162109
Iteration: 10    Loss value: 496.908325195312
Iteration: 200   Loss value: 231.474166870117
Iteration: 400   Loss value: 227.11474609375
Iteration: 600   Loss value: 227.070495605469
Iteration: 800   Loss value: 227.070404052734
Iteration: 1000  Loss value: 227.070404052734
Iteration: 1200  Loss value: 227.070404052734
Iteration: 1400  Loss value: 227.070404052734
Iteration: 1600  Loss value: 227.070404052734
Iteration: 1800  Loss value: 227.070404052734
Iteration: 2000  Loss value: 227.070404052734
Iteration: 2200  Loss value: 227.070404052734
Iteration: 2400  Loss value: 227.070434570312
Iteration: 2600  Loss value: 227.070434570312
Iteration: 2800  Loss value: 227.070434570312
Iteration: 3000  Loss value: 227.070434570312
Iteration: 3200  Loss value: 227.070434570312
Iteration: 3400  Loss value: 227.070388793945
Iteration: 3600  Loss value: 227.070404052734
Iteration: 3800  Loss value: 227.070434570312
Iteration: 4000  Loss value: 227.070404052734
Iteration: 4200  Loss value: 227.070434570312
Iteration: 4400  Loss value: 227.070434570312
Iteration: 4600  Loss value: 227.070434570312
Iteration: 4800  Loss value: 227.070404052734
Iteration: 5000  Loss value: 227.070404052734
Iteration: 5200  Loss value: 227.132614135742
Iteration: 5400  Loss value: 227.070434570312
Iteration: 5600  Loss value: 227.070404052734
Iteration: 5800  Loss value: 227.071762084961
Iteration: 6000  Loss value: 227.070434570312
Iteration: 6200  Loss value: 227.093811035156
Iteration: 6400  Loss value: 227.070434570312
Iteration: 6600  Loss value: 227.070434570312
Iteration: 6800  Loss value: 227.070877075195
Iteration: 7000  Loss value: 227.070404052734
Iteration: 7200  Loss value: 227.070617675781
Iteration: 7400  Loss value: 227.070404052734
Iteration: 7600  Loss value: 227.070404052734
Iteration: 7800  Loss value: 227.070404052734
Iteration: 8000  Loss value: 227.070404052734
Iteration: 8200  Loss value: 227.076507568359
Iteration: 8400  Loss value: 227.070434570312
Iteration: 8600  Loss value: 227.070434570312
Iteration: 8800  Loss value: 227.071090698242
Iteration: 9000  Loss value: 227.070434570312
Iteration: 9200  Loss value: 227.070434570312
Iteration: 9400  Loss value: 227.070404052734
Iteration: 9600  Loss value: 227.070434570312
Iteration: 9800  Loss value: 227.070434570312
Iteration: 10000     Loss value: 229.465744018555</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-20_e6de639c4bea2da4e2c4c2dddf32a00c">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">12</span>, <span class="at">repr.plot.height=</span><span class="dv">7</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">as_array</span>(b), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"dodgerblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-21_bc891f9393c01e26742a89216251fe0b">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L_numeric[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>], <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(L[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>], <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross validation</h2>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-22_5537f8f89e77407291d5867dd1f239e4">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Boston <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     crim zn indus chas   nox    rm  age    dis rad tax ptratio lstat medv
1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3  4.98 24.0
2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8  9.14 21.6
3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8  4.03 34.7
4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7  2.94 33.4
5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7  5.33 36.2
6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7  5.21 28.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 506  13</code></pre>
</div>
</div>
<p>Split the data into training (80%) and testing sets (20%)</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-23_dbd7b2a3cd729a8afd70a8415184e1a3">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fold <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="fu">nrow</span>(df)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>fold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  82 417 442 117 401 480 426 236 244 505 377 334 319 388  29  61 146 273
 [19]  68   2 180 248 272 173 371 500 364 353  40 260 250 185  44 315 306 158
 [37]  46 429  16 227 283 309 234  72 406 154 349 224 151 477 441 266   9 296
 [55] 220 292 172 470 312 433 210 142 415 232  30 199 112 204 357 352 484 206
 [73]  99  63 372 373 203 226 141 175 416 149  36 436 490 299 120 479  53 247
 [91] 160 291 155  51 369 193 171 496 348 340 205 215  11 253  73 400 366 494
[109]  37 411 122 147  86 297  48 345 354 137 414 402 109 162 451 245 418  56
[127] 187 305 195  57  58 438 237 428 125 425 397  93 145 463 483 108 455  62
[145] 139  87  17  26 101 395 277  55 420  91  19 405  38 410 217 126 186  32
[163]  78 502 471 209 439 264 304 386 140 225 271 465  27 381  35 489  10 506
[181] 295 308   5 408  20 469 437 495 179 380 134  81 323 446 202 367  77 161
[199]  74 256 503 316  96   1 255  79 336 269 124 228  66  13 342 467 191 493
[217]  88 200 389 129  89 233 116 263 412 176 394 392 136 359 239  64 374  94
[235] 358  97 229 457 498 159  67 212 476 281 313 486  76 460  23 333 413 474
[253]  50</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-24_a90e2b65c9d05fa55739c9bb5e19945f">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="sc">-</span>fold)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">slice</span>(fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-25_a613c441cc167d84b740a8ec9e97b4b3">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(test) <span class="sc">+</span> <span class="fu">nrow</span>(train) <span class="sc">-</span> <span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-26_4b59b3bad0a96e953db823835ee0c4e7">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> train)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = medv ~ ., data = train)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5646  -2.0592  -0.5276   1.6142  20.6150 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  37.604008   6.030417   6.236 2.01e-09 ***
crim         -0.069242   0.051401  -1.347 0.179215    
zn            0.046721   0.017394   2.686 0.007736 ** 
indus         0.055265   0.075369   0.733 0.464112    
chas          1.922679   1.025980   1.874 0.062147 .  
nox         -16.211936   4.612427  -3.515 0.000526 ***
rm            3.822493   0.544754   7.017 2.30e-11 ***
age           0.018447   0.017477   1.056 0.292252    
dis          -1.144944   0.252606  -4.533 9.20e-06 ***
rad           0.236039   0.082217   2.871 0.004458 ** 
tax          -0.016594   0.004625  -3.588 0.000404 ***
ptratio      -0.941234   0.155448  -6.055 5.38e-09 ***
lstat        -0.508898   0.071457  -7.122 1.23e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.073 on 240 degrees of freedom
Multiple R-squared:  0.7894,    Adjusted R-squared:  0.7788 
F-statistic: 74.95 on 12 and 240 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-27_c5e46acefc4e06139f2cf814d44dd1fd">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-28_36512d0a0022789da29c6714849b8b1a">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mspe <span class="ot">&lt;-</span> <span class="fu">mean</span>((test<span class="sc">$</span>medv <span class="sc">-</span> y_test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mspe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30.74259</code></pre>
</div>
</div>
</section>
<section id="k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation">k-Fold Cross Validation</h2>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-29_524cce9828e3a8a9759189275d2fa2ec">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>k, <span class="fu">nrow</span>(df), <span class="at">replace=</span>T)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 3 2 4 3 4 1 2 4 1 5 3 3 5 3 4 1 4 3 5 2 2 5 4 4 4 2 1 2 1 5 3 2 5 3 3 5 3
 [38] 1 1 5 5 5 1 4 4 4 4 3 2 1 4 2 4 4 4 5 2 5 3 4 1 5 5 4 1 3 4 2 4 1 4 4 5 3
 [75] 2 3 1 1 4 5 4 1 3 3 3 5 5 1 4 4 5 5 3 5 3 4 3 4 2 4 1 1 2 5 1 2 2 2 3 1 4
[112] 2 1 1 2 5 2 5 1 2 5 2 2 2 2 3 3 1 1 2 1 5 4 3 3 5 5 3 1 1 1 3 4 1 3 3 1 3
[149] 3 4 5 4 1 4 1 2 1 2 4 2 2 5 2 3 1 2 1 4 4 5 5 2 2 4 1 5 3 3 4 2 1 2 2 3 2
[186] 5 1 3 3 4 5 5 2 2 3 3 5 3 3 3 4 2 5 5 4 5 3 3 1 1 1 3 5 3 3 4 3 1 3 1 1 2
[223] 2 5 5 4 2 4 5 4 2 4 3 5 5 4 1 2 3 5 3 5 5 2 5 3 1 2 3 4 2 1 2 1 2 1 4 2 3
[260] 2 3 2 3 4 3 3 1 4 5 1 1 1 4 4 1 5 1 3 1 5 3 5 3 5 3 1 2 1 1 2 3 4 2 1 4 1
[297] 5 1 4 5 5 5 2 2 4 1 2 3 5 4 2 2 4 1 2 4 5 3 2 2 5 1 5 3 3 4 2 3 2 4 5 3 2
[334] 5 5 2 5 4 2 1 2 1 1 2 2 4 5 4 5 1 2 4 1 3 5 1 5 4 2 5 1 3 1 5 4 5 4 1 3 3
[371] 2 2 5 4 3 1 2 1 5 1 3 5 4 1 3 2 5 4 4 2 2 5 3 5 4 2 3 5 3 2 3 1 4 3 3 4 2
[408] 4 5 2 4 3 3 2 5 1 5 2 2 2 1 2 2 5 4 4 4 4 2 2 2 5 5 3 4 4 2 1 4 1 1 2 1 3
[445] 2 5 4 5 5 5 3 1 5 5 3 2 1 4 4 5 3 1 3 3 1 5 3 4 5 5 3 2 3 4 5 4 2 3 3 4 3
[482] 1 3 3 5 2 4 5 5 1 5 5 5 4 3 4 1 1 2 5 2 3 2 4 2 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_folds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    df_folds[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    df_folds[[i]]<span class="sc">$</span>train <span class="ot">=</span> df[<span class="fu">which</span>(folds <span class="sc">!=</span> i), ]</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    df_folds[[i]]<span class="sc">$</span>test <span class="ot">=</span> df[<span class="fu">which</span>(folds <span class="sc">==</span> i), ]</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-30_2cec1f64a445ccabc526ea6ade1e658a">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df_folds[[<span class="dv">2</span>]]<span class="sc">$</span>train) <span class="sc">+</span> <span class="fu">nrow</span>(df_folds[[<span class="dv">2</span>]]<span class="sc">$</span>test) <span class="sc">-</span> <span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-31_d73f046b3905d043a6dd554a2e9bc97d">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df_folds[[<span class="dv">3</span>]]<span class="sc">$</span>train) <span class="sc">+</span> <span class="fu">nrow</span>(df_folds[[<span class="dv">4</span>]]<span class="sc">$</span>test) <span class="sc">-</span> <span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-32_455646b42f51b7f6c64a83f304debf1a">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>kfold_mspe <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(medv <span class="sc">~</span> ., df_folds[[i]]<span class="sc">$</span>train)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, df_folds[[i]]<span class="sc">$</span>test)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    kfold_mspe[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((y_hat <span class="sc">-</span> df_folds[[i]]<span class="sc">$</span>test<span class="sc">$</span>medv)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>kfold_mspe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21.24001 24.63625 31.39036 18.33662 25.90633</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-33_6af6a633eedc9f51ed77db7d68d733d8">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean(kfold_mspe)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrapped-in-a-function" class="level2">
<h2 class="anchored" data-anchor-id="wrapped-in-a-function">Wrapped in a function</h2>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-34_0597d591a5f0b83fda08b94f0788d934">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>make_folds <span class="ot">&lt;-</span> <span class="cf">function</span>(df, k){</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>k, <span class="fu">nrow</span>(df), <span class="at">replace=</span>T)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    df_folds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        df_folds[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        df_folds[[i]]<span class="sc">$</span>train <span class="ot">=</span> df[<span class="fu">which</span>(folds <span class="sc">!=</span> i), ]</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        df_folds[[i]]<span class="sc">$</span>test <span class="ot">=</span> df[<span class="fu">which</span>(folds <span class="sc">==</span> i), ]</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df_folds)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-35_031e9421196a71877ab6908adba33db0">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>cv_mspe <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, df_folds){</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    kfold_mspe <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(df_folds)){</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, df_folds[[i]]<span class="sc">$</span>train)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, df_folds[[i]]<span class="sc">$</span>test)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>        kfold_mspe[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((y_hat <span class="sc">-</span> df_folds[[i]]<span class="sc">$</span>test<span class="sc">$</span>medv)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">mean</span>(kfold_mspe))</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-36_d14f1d67f34674e21320e90aa2c415a7">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv_mspe</span>(medv <span class="sc">~</span> ., df_folds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.30191</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv_mspe</span>(medv <span class="sc">~</span> <span class="dv">1</span>, df_folds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 84.05964</code></pre>
</div>
</div>
<section id="using-thecaret-package" class="level3">
<h3 class="anchored" data-anchor-id="using-thecaret-package">Using the<code>caret</code> package</h3>
<p>Define the training control for cross validation</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-37_6787536bc167a624c7c2c6cb7973a8a0">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-38_a44b93b65b660387543c818d4bf9b7b3">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> df, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> ctrl)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.1304  -2.7673  -0.5814   1.9414  26.2526 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  41.617270   4.936039   8.431 3.79e-16 ***
crim         -0.121389   0.033000  -3.678 0.000261 ***
zn            0.046963   0.013879   3.384 0.000772 ***
indus         0.013468   0.062145   0.217 0.828520    
chas          2.839993   0.870007   3.264 0.001173 ** 
nox         -18.758022   3.851355  -4.870 1.50e-06 ***
rm            3.658119   0.420246   8.705  &lt; 2e-16 ***
age           0.003611   0.013329   0.271 0.786595    
dis          -1.490754   0.201623  -7.394 6.17e-13 ***
rad           0.289405   0.066908   4.325 1.84e-05 ***
tax          -0.012682   0.003801  -3.337 0.000912 ***
ptratio      -0.937533   0.132206  -7.091 4.63e-12 ***
lstat        -0.552019   0.050659 -10.897  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.798 on 493 degrees of freedom
Multiple R-squared:  0.7343,    Adjusted R-squared:  0.7278 
F-statistic: 113.5 on 12 and 493 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-39_2e49f46ff34f2eddc083df069e282943">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="caret-for-lasso" class="level3">
<h3 class="anchored" data-anchor-id="caret-for-lasso"><code>caret</code> for LASSO</h3>
<section id="bias-variance-tradeoff" class="level4">
<h4 class="anchored" data-anchor-id="bias-variance-tradeoff">Bias-variance tradeoff</h4>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-hash="index_cache/html/unnamed-chunk-40_deed08aa5148c75928062169f2f3a11c">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the tuning grid</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="at">by =</span> <span class="fl">0.001</span>))</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using Lasso regression with cross-validation</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    medv <span class="sc">~</span> ., </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df, </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"glmnet"</span>, </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> ctrl, </span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> grid, </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">standardize =</span> <span class="cn">TRUE</span>, </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"gaussian"</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
>>>>>>> 5aee636 (fasttrack)
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>